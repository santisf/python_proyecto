{% extends "AppAdopcion/inicio.html" %}
{% load static %}
{% block contenidoQueCambia %}
<div class="container py-4">
  <h1>Solicitudes</h1>

  {% if solicitudes %}
    <div class="row row-cols-1 row-cols-sm-2 row-cols-md-3 g-3">
      {% for s in solicitudes %}
        <div class="col">
          <div class="card card-solicitud h-100" style="background-color: #dae2cb;">
            <div class="row g-0 align-items-center">
              <div class="col-auto">
                <div class="thumb-solicitud">
                  {% if s.animal.foto %}
                    <img src="{{ s.animal.foto.url }}" alt="{{ s.animal.nombre }}"
                         class="img-cover"
                         style="width:90px !important; height:70px !important; object-fit:cover !important; display:block;">
                  {% else %}
                    <img src="{% static 'img/no-image.png' %}" alt="Sin foto"
                         class="img-cover"
                         style="width:90px !important; height:70px !important; object-fit:cover !important; display:block;">
                  {% endif %}
                </div>
              </div>

              <div class="col">
                <div class="card-body py-2 px-3">
                  <h6 class="card-title mb-1">{{ s.animal.nombre }}</h6>
                  <p class="mb-1 small">
                    {{ s.user.get_full_name|default:s.user.username }} — solicitante
                  </p>
                  <p class="mb-1 small text-muted">fecha: {{ s.fecha_de_solicitud|date:"d M. Y" }}</p>

                  {# Badge de estado con colores según valor #}
                  <p class="mb-0 small">
                    {% if s.estado == "en_proceso" %}
                      <span class="badge bg-warning text-dark">En proceso</span>
                    {% elif s.estado == "aprobado" %}
                      <span class="badge bg-success">Aprobado</span>
                    {% elif s.estado == "cancelado" %}
                      <span class="badge bg-danger">Cancelado</span>
                    {% else %}
                      <span class="badge bg-secondary">{{ s.get_estado_display }}</span>
                    {% endif %}
                  </p>

                  <div class="mt-2 d-flex gap-2">
                    {# Botón Editar: solo visible para superusuario #}
                    {% if request.user.is_superuser %}
                      <a href="{% url 'solicitud_update' s.pk %}" class="btn btn-sm btn-busqueda">Editar</a>
                    {% endif %}

                    {# Botón Eliminar: visible para usuarios autenticados (la vista debe validar permisos) #}
                    {% if request.user.is_authenticated %}
                      <form method="post" action="{% url 'solicitud_delete' s.pk %}" style="display:inline;">
                        {% csrf_token %}
                        <button type="submit"
                                class="btn btn-sm btn-adopcion"
                                onclick="return confirm('¿Eliminar esta solicitud? Esta acción no se puede deshacer.');">
                          Eliminar
                        </button>
                      </form>
                    {% endif %}
                  </div>

                </div>
              </div>
            </div>
          </div>
        </div>

      {% endfor %}
    </div>

    {% if page_obj %}
      <div class="d-flex justify-content-center mt-4">
        <nav aria-label="Page navigation">
          <ul class="pagination">
            {% if page_obj.has_previous %}
              <li class="page-item"><a class="page-link" href="?page={{ page_obj.previous_page_number }}">&laquo;</a></li>
            {% else %}
              <li class="page-item disabled"><span class="page-link">&laquo;</span></li>
            {% endif %}

            {% for num in page_obj.paginator.page_range %}
              {% if page_obj.number == num %}
                <li class="page-item active"><span class="page-link">{{ num }}</span></li>
              {% else %}
                <li class="page-item"><a class="page-link" href="?page={{ num }}">{{ num }}</a></li>
              {% endif %}
            {% endfor %}

            {% if page_obj.has_next %}
              <li class="page-item"><a class="page-link" href="?page={{ page_obj.next_page_number }}">&raquo;</a></li>
            {% else %}
              <li class="page-item disabled"><span class="page-link">&raquo;</span></li>
            {% endif %}
          </ul>
        </nav>
      </div>
    {% endif %}

  {% else %}
    <p>No hay solicitudes registradas todavía.</p>
  {% endif %}
</div>
{% endblock %}
